---
title: 调试纪录
date: 2019-12-16 17:00:29
tags:
- 调试纪录
categories: notes
typora-root-url: 调试记录
---

**12/16/下午**

- ``Adapt/lib/config.py``
- ``Adapt/models/dpn.py``删除最前面from import前面的所有注释
- ``Adapt/experiments/clipart/efficientnet_b4/config.py``修改75行从true到100 可以跑，显示RuntimeError: cuda runtime error (38) : no CUDA-capable device is detected at问题，已经改回true

  **12.26**

- rice dataset四类米饭：

  fried rice 炒饭

  jollof (西非) 辣椒炖(鱼)肉饭;

  plain rice 纯白米饭（没有其他配菜花样）

  waakye 豆煮饭 

- 256类：

  身份证名
  1饭
  2条鳗鱼饭
  3抓饭
  4个鸡饭蛋
  5猪排饭
  6牛肉咖喱
  7个寿司
  8鸡饭
  9炒饭
  10天妇罗碗
  11石锅拌饭
  12吐司！！！！！！！！！！！！！！！！！
  13牛角包
  14卷面包
  15葡萄干面包
  16筹码屁股
  17个汉堡
  18个披萨
  19个三明治
  20乌冬面
  21天妇罗乌冬面
  22荞麦面
  23拉面
  24牛肉面
  25张力面
  26炒面
  27意大利面
  28日式煎饼
  29章鱼烧
  30焗
  31炒蔬菜
  32炸丸子
  33烤茄子
  34菠菜炒
  35蔬菜天妇罗
  36味o汤
  37罐
  38香肠
  39关东煮
  40个煎蛋卷
  41甘莫达基
  42角子
  43炖
  44照烧鱼
  45条炸鱼
  46烤三文鱼
  47三文鱼三明治
  48生鱼片
  49烤太平洋秋刀鱼
  50个寿喜烧
  51糖醋猪肉
  52条轻烤鱼
  53蒸鸡蛋火锅
  54天妇罗
  55炸鸡
  56牛lo
  57 Nanbanzuke
  58个水煮鱼
  59牛肉加土豆
  60磅牛排
  61牛排
  62条鱼干
  63姜猪肉炒香
  64辣辣椒豆腐
  65烤鸡肉串
  66卷心菜卷
  67煎蛋卷
  68个鸡蛋面朝上
  69纳豆
  70冷豆腐
  71蛋卷
  72冷面
  73牛肉和辣椒炒
  74 pork肉
  75煮鸡肉和蔬菜
  76刺身碗
  77个寿司碗
  78鱼形煎饼配豆酱
  79虾带冷源
  80只烤鸡
  81肉饺子
  82煎蛋卷
  83咖喱炸肉排
  84意大利面条肉酱
  85炸虾
  86土豆沙拉
  87绿色沙拉
  88通心粉沙拉
  89日本豆腐和蔬菜杂烩
  90猪肉味o汤
  91汤
  92牛肉碗
  93 kinpira风格的牛
  94饭团
  95披萨吐司
  96条蘸面
  97热狗
  98炸薯条
  99米
  100 goya chanpuru
  101绿咖喱
  102冲绳荞麦面
  103芒果布丁
  104杏仁果冻
  105 ji
  106达克·加尔比
  107干咖喱
  108卡玛米士
  109米粉
  110西班牙海鲜饭
  111潭门
  112 kushikatu
  113黄咖喱
  114煎饼
  115斜纹棉布
  116绉
  117提拉米苏
  118松饼
  119稀有芝士蛋糕
  120脆饼
  121杂碎
  122两次煮熟的猪肉
  123蘑菇烩饭
  124 samul
  125 Zoni
  126法式吐司
  127白色细面
  128蔬菜通心粉汤
  129 pot au feu
  130块鸡块
  131名
  132法式面包
  133米粥
  134烤鳗鱼碗
  135清汤
  第136章
  137年
  138 inarizushi
  139猪里脊肉
  140猪排
  141鸡排
  142火腿肉饼
  143碎肉排
  144薄片生马肉
  145百吉饼
  146烤饼
  147玉米饼
  148玉米饼
  149玉米片
  150块面包
  151炒蛋
  152焗饭
  153烤宽面条
  154凯撒沙拉
  155燕麦片
  156炸猪肉饺子汤
  157年
  158松饼
  159爆米花
  160奶油泡芙
  161甜甜圈
  162苹果派
  163冻糕
  164炒猪肉
  165羊肉串
  166道菜，包括炸土豆，茄子和青椒
  167烤鸭
  168火锅
  169五花肉
  170小笼包
  171月饼
  172蛋ust
  173牛肉面汤
  174猪排
  175碎猪肉饭
  176鱼丸汤
  177牡蛎煎蛋
  178糯米
  179特里尼布丁
  180臭豆腐
  181柠檬无花果冻
  182 so
  183酸虾汤
  184泰国木瓜沙拉
  185块切成薄片的海南鸡配腌制米饭
  186酸辣鱼和蔬菜炖肉
  187炒杂菜
  188蚝油牛肉
  189猪肉沙爹
  190辣鸡丁沙拉
  191咖喱面
  192猪肉粘面
  193柠檬猪肉
  194炖猪腿
  195炭烧猪脖子
  196炒贻贝煎饼
  197炸鸡翅
  198红烧叉烧
  199鸭烧饭
  200米脆皮猪肉
  201云吞汤
  202咖喱鸡饭配椰子
  203香酥面
  204鸡黄咖喱鸡蛋面
  205椰奶汤
  pho 206
  207顺化牛肉米粉汤
  208条蜗牛细面条
  209炸春卷
  210蒸米饭
  211虾肉饼
  212猪肉丸子
  213椰奶味薄饼配虾和牛肉
  214小蒸咸米饼
  215汤圆
  216疯子
  217豪皮亚
  218马拉萨达
  劳劳219
  220垃圾邮件musubi
  221牛尾汤
  222阿斗
  223伦比
  224布朗尼
  225油条
  226什锦饭
  227炒饭
  228 ayam goreng
  229 ayam bakar
  230 bubur ayam
  古来231
  232叻沙
  233 mie ayam
  234 mie goreng
  235纳西坎普尔
  236椰浆饭
  237椰浆饭
  238 ba鱼
  239卡亚吐司
  240白骨茶
  241咖喱泡芙
  242炒面
  243江面243
  244宫保鸡丁
  245 ll
  246茄子茄子
  247三杯鸡
  248豆腐家庭风格
  249椒盐虾仁
  250烤三文鱼
  251纳帕白菜红烧肉丸
  252冬瓜汤
  253蒸排骨
  254中国南瓜派
  255八宝饭
  256酸辣汤

- 101 类

  苹果派
  小排骨
  巴卡拉
  牛肉生牛肉片
  art牛肉
  甜菜沙拉
  贝尼格斯
  拌饭
  面包布丁
  早餐卷饼
  布鲁斯凯塔
  凯撒沙拉
  香炸奶酪卷
  卡普雷塞沙拉
  胡萝卜蛋糕
  酸橘汁腌鱼
  乳酪蛋糕
  奶酪盘
  咖喱鸡
  鸡肉玉米饼
  鸡翅
  巧克力蛋糕
  巧克力慕斯
  丘罗斯
  蛤蜊杂烩
  俱乐部三明治
  蟹饼
  焦糖布丁
  法式夫人
  纸杯蛋糕
  芥末蛋
  甜甜圈
  水饺
  毛豆
  本尼迪克特蛋
  田螺
  沙拉三明治
  烤里脊肉片
  鱼和薯条
  鹅肝
  炸薯条
  法式洋葱汤
  法式吐司
  炸鱿鱼
  炒饭
  冰冻酸奶
  蒜蓉面包
  汤团
  希腊式沙拉
  烤奶酪三明治
  烤三文鱼
  鳄梨
  饺子
  汉堡包
  酸辣汤
  热狗
  墨西哥煎蛋
  鹰嘴豆泥
  冰淇淋
  烤宽面条
  龙虾浓汤
  龙虾卷三明治
  通心粉和奶酪
  马卡龙
  味噌汤
  青口贝
  玉米片
  煎蛋卷
  洋葱圈
  生蚝
  泰式炒河粉
  西班牙海鲜饭
  薄煎饼
  潘纳陶砖
  北京烤鸭
  ho
  比萨
  猪排
  普丁
  牛排
  拉猪肉三明治
  拉面
  馄饨
  红色天鹅绒蛋糕
  烩饭
  萨摩萨
  生鱼片
  扇贝
  海藻沙拉
  虾和粉打窝沙食
  肉酱意粉
  意粉培根蛋面
  春卷
  牛扒
  草莓脆饼
  寿司
  玉米饼
  章鱼烧
  提拉米苏
  art金枪鱼
  威化饼

- [x] rice 从头训练 32064  因为把vgg19不用预训练参数的条件，改为了预训练的条件，pretrained=true, 和101,256一样

  

- [x] 101训练测试，保存trained pwf模型文件， 训练测试划分：

  `train_data,test_data=torch.utils.data.random_split(dataset,(100000,1000))`

  

- [x] 256训练测试，保存trained pwf模型文件， 训练测试划分：

`train_data,test_data=torch.utils.data.random_split(dataset,(30000,1395))`



- [x] 101到rice应该保持冻结特征提取部分的参数 （111行） 正在训练32065 

\# wjg 12.26 保持和multi一致，从101拿过来的pwf文件中的特征提取部分的参数不参与训练，冻结

for param in model.features:

  param.requires_grad = False # wjg 12.26 do not require gradient descent for feature extraction parameters.



- [x] 256到rice应该保持冻结特征提取部分的参数 （111行） 正在训练32066

  

- [ ] 101去掉rice相关类别训练

- [ ] 256 去掉rice相关类别训练
- [ ] 101选4类没有rice的迁移到ricedataset 4×1000
- [ ] 256选4类没有rice的迁移到ricedataset 621+131+116+122=990 - 4 = 986 （因为每个里面有一个坐标文件！）

|         模型          |      test acc      | 提交任务slurm编号 | 备注                                                         | 问题                                                 | 对应py文件                 |
| :-------------------: | :----------------: | :---------------: | ------------------------------------------------------------ | ---------------------------------------------------- | -------------------------- |
|     rice-scratch      |        82%         |       32064       | 改为使用vgg19 pretrained参数epoch=30                         |                                                      | rice-scratch.py            |
|     rice-scratch      |      83.7500%      |       32210       | epoch=30，网络4096-512，学习率定0.001                        |                                                      |                            |
|                       |                    |       32233       | epoch=1，网络4096-512，学习率定0.001改                       |                                                      |                            |
|                       |                    |                   |                                                              |                                                      |                            |
|      101-to-rice      |        85 %        |       32065       | 改为冻结特征提取参数                                         |                                                      | 101-to-rice.py             |
|      256-to-rice      |        86 %        |       32066       | 改为冻结特征提取参数                                         |                                                      | 256-to-rice.py             |
|                       |                    |                   |                                                              |                                                      |                            |
|       4-in-101        |        87%         |       32067       | 训练101类中的4类                                             | 有问题！没有改类别是4                                | 4-in-101.py                |
|   4-in-101-to-rice    |      81.2500       |       32068       | 101中选前4类，没有rice，模型迁移到rice                       | 改成显示4为小数准确率，有问题！预训练没有改类别是4！ | 4-in-101-to-rice.py        |
|       4-in-256        |                    |       32069       |                                                              | 类别4                                                | 4-in-256.py                |
|                       |                    |                   |                                                              |                                                      |                            |
|                       |                    |                   |                                                              |                                                      |                            |
|    **date：1228**     |                    |                   |                                                              |                                                      |                            |
|          101          |                    |       32084       | epoch=30 原来3                                               |                                                      | 废                         |
|          256          |                    |       32085       | epoch=30 原来3                                               |                                                      | 废                         |
|       4-in-101        |      88.7500%      |       32092       | epoch=30                                                     |                                                      | 废                         |
|       4-in-256        |                    |       32097       | epoch=30                                                     |                                                      | 废                         |
|      rice-scrach      |      88.7500%      |       32099       | 改epoch30为10                                                |                                                      |                            |
|      rice-scrach      |      83.7500%      |       32235       | epoch=30 网络4096-512，学习率0.001改                         | 每5个batch缩减0.1，10后面训不动                      |                            |
|      rice-scrach      |      87.5000%      |       32236       | epoch=30 网络4096-512，学习率0.001改,dropout=0.6             | 每5个batch缩减0.1，10后面训不动                      |                            |
|      rice-scrach      |      81.2500%      |       32243       | 加入weight decay，0.6，scheduler                             | 动态调整Lr，后面仍然训不动                           |                            |
|      rice-scrach      |      85.0000%      |       32247       | 改dropout=0.7，去掉weight decay，scheduler下限0.0000001      | 后面仍然训不动                                       |                            |
|     [=rice-scrach     |                    |       32289       | 改dropout=0.7，weight decay0.0005，去掉scheduler             | 后面可以训动，但是准确率比训练集还是差很多。         | 可视化版本不匹配，跑不出来 |
|    【rice-scrach】    |      88.7500%      |       32312       | 还原vgg19的4096维度结构，调dropout=0.7，weight decay=0.0005，scheduler，epoch=60 | 20轮就88.7500%，21轮起后面降到87.5                   |                            |
|                       |                    |                   |                                                              |                                                      |                            |
|    **修改epoch后**    |                    |                   |                                                              |                                                      |                            |
|          101          |      49.5200       |                   | epoch=10                                                     | 没有得到结果，李嘉荣在跑                             |                            |
|          256          |      35.3405       |                   | epoch=10                                                     |                                                      |                            |
|          256          |      33.9068%      |       32149       | epoch=3   !!!!!!!!!!!!!!!!!!                                 | 10轮timeout了，所以改回3轮，只训练3轮准确率很低      |                            |
|          101          |      43.8000%      |       32177       | epoch=3   !!!!!!!!!!!!!!!!!!                                 |                                                      |                            |
|       4-in-101        |      85.5000%      |     【32108】     | epoch=10                                                     | 101取前4类，没有米饭类                               | 稳定                       |
|                       |                    |                   |                                                              |                                                      |                            |
|       4-in-256        |      94.0860%      |     【32110】     | epoch=10                                                     | 256取前4类，都是米饭相关类                           | 稳定                       |
|                       |                    |                   |                                                              |                                                      |                            |
|   4-in-101-to-rice    |      81.2500%      |       32150       | epoch=10                                                     | 101上4类finetune到rice                               | 不太稳定！！！             |
|                       | 86.75取最后5次平均 |     【32453】     | epoch=30                                                     |                                                      |                            |
|   4-in-256-to-rice    |      78.7500%      |       32151       | epoch=10                                                     | 256上4类finetune到rice                               | 不太稳定！！！             |
|                       | 83.25取最后5次平均 |     【32455】     | epoch=30                                                     |                                                      |                            |
| 4in101+4in256-to-rice |      86.2500%      |       32156       | epoch=10                                                     | 101上4类，256上4类，两个source，finetune到rice       | 相对稳定                   |
|                       | 82.75取最后5次平均 |     【32456】     | epoch=30                                                     |                                                      |                            |

**12.27**

- 修改所有最后输出测试集上的准确率

- 修改所有准确率相关参数为4位小数输出

- 修改所有epoch数为30！ 101和256的原始训练  

  - 训练时间太长，改成10次！！！！！！！！！！！！！！

- 修改相关注释提示输出

  

【1230】

|     模型     |                 test acc                  | slurm序号 |           参数细节           |      备注       | 问题 |
| :----------: | :---------------------------------------: | :-------: | :--------------------------: | :-------------: | :--: |
|     101      |       42.0， 40.4， 43.8 = 42.06667       | 【32177】 | epoch=3   !!!!!!!!!!!!!!!!!! |                 |      |
|     256      | 23.1541，30.1075，33.9068= 29.05613333333 | 【32149】 | epoch=3   !!!!!!!!!!!!!!!!!! |                 |      |
|   101-rice   |             80.75最后5次平均              | 【32461】 |           epoch=30           | 用上述32177模型 |      |
|   256-rice   |             81.75最后5次平均              | 【32462】 |           epoch=30           | 用上述32149模型 |      |
| 101+256-rice |                    82                     | 【32474】 |           epoch=30           |                 |      |
|              |                                           |           |                              |                 |      |

【再跑一个256中选4类不是米饭的】



27意大利面152-1

29章鱼小丸子135-1

118 华夫饼103-1

244宫保鸡丁112-1

一共498

| 模型                  | 序号      | test准确率              |            |                     |                                          |
| --------------------- | --------- | ----------------------- | ---------- | ------------------- | ---------------------------------------- |
| 4in256                | 32488     | 91.63266                | epoch=10   | 数据量大概500，较少 | 后面101取4类，把4000数据采样到500左右    |
|                       | 【32489】 | 94.89798                | epoch=30   |                     | 好                                       |
| 4in256torice          | 32490     | 82.25                   | epoch=30   |                     |                                          |
|                       | 【32528】 | 88.00 中间平均          | 【epoch=60 |                     |                                          |
| 4in101                | 【32503】 | 85最终，平均最后5个是80 | epoch=30   |                     | 4类共4000，降采样到400，有点过拟合。。。 |
| 4in101torice          | 32504     | 91.25最终，取平均是81   | epoch=30   |                     |                                          |
|                       | 【32527】 | 87.14中间平均           | 【epoch=60 |                     |                                          |
| 4in101+4in256-to-rice | 【32546】 | 83.75                   | epoch=60   |                     |                                          |







【第1组实验】

transfer from food-101 and food-256  using complete 101 and 256 categories



【第2组实验】

transfer from food-101 and food-256  using 4 categories in 101 and  4 categories in 256



【第3组实验】

transfer from food-101 and food-256  using 4 categories in 101 and  4 categories in 256

- make them 400-500 source images

- no rice examples in any sources 

  

